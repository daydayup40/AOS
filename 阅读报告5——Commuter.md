# 《The Scalable Commutativity Rule》阅读报告
# 论文概述
现有的很多评估可扩展性的方法都需要软件实现之后，而不能在软件设计之初就可以开始评估可扩展性，文章提出了一种通过接口的设计来对可扩展性进行评估的方案，并进行了形式化的证明，实现了一个Commuter的工具用户测试接口设计的可扩展性。
# 现有的问题
当前主流的可扩展性测试方法就是将一个软件放在不同核心数的机器中执行，用辅助工具来记录软件表现出的性能随核数的变化。这种方法有很大的缺陷，首先这种测试方法不能准确定位性能瓶颈位置，有可能是文件系统，有可能是IO等等很难区分，再者这种测试方法需要软件基本完成才能用于测试，不能高效的辅助软件开发。
# 核心工作
在多核的机器上，很多情况多核处理器的缓存有类似MESI的协议保持一致，这种情况下，如果接口的设计需要每个核的状态保持一个较为同步的情形，即不同操作之间互有影响，那么可能其他的核就需要等待另外的核完成操作才能继续进行，这就大大降低了可扩展性。
因此，如果接口设计时，能够尽量将操作的实现设计的顺序无关（称为commute，仅通过接口无法区分操作的顺序），就能更大可能实现好的可扩展性。
为了确认这个想法的正确性，作者进行了形式化的证明，并且得到一个叫做SIM交换性的性质，即state-dependent，interface-based，monotonic。
在上面接口设计规则和SIM交换性的指导下可以帮助我们设计可扩张性更好的系统，但是要充分理解复杂接口的交换性非常麻烦，为此作者实现了Commuter工具帮助发现接口设计中的可扩展性瓶颈：首先，ANALYZER建立接口的符号模型并计算接口顺序无关的精确条件；然后TESTGEN接受这些条件并根据接口模型生成具有顺序无关的操作集合的具体测试用例，最后MTRACE检查每个测试用例的特定实现是否有冲突。
接口遵循POSIX标准设计后，给出spec规格说明书作为Commuter的输入，Commuter会更具spec生成状态转换图来找出可扩展性瓶颈。
# 实验
作者对18个简化的POSIX文件系统和虚拟内存系统调用进行了测试，生成了13664个测试用例对，每一个测试用例对都可以根据规则将接口设计改为一个顺序无关的实现。最后文章还对sv6的接口设计进行了实验，发现通过应用规则来实现POSIX的广泛可扩展实现是切实可行的。